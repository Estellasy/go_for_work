# 关系数据库

# 非关系数据库
## Redis
### 基础
1. 什么是Redis？
   Redis是一种基于key-value的NoSQL数据库。
   Redis的value支持string/hash/list/set/zset/bitmaps/hyperloglog/geo等数据结构。
   Redis将所有数据都存放在内存中，并且可利用快照和日志的形式将数据保存到硬盘上，使得在断电或者故障的时候，内存中的数据不会丢失。
   除了以上功能外，Redis还提供了key过期、发布订阅、事务、流水线、Lua脚本等附加功能。
2. Redis可以用来干什么？
   - 缓存：降低数据源压力，提高响应速度。
   - 计数器：Redis天然支持计数功能，可以用来记录浏览量、点赞量等。
   - 排行榜：Redis的list和set结构。
   - 社交网络：赞/踩/共同好友/粉丝/推送/下拉刷新
   - 消息队列：发布订阅和阻塞队列，可以满足一般消息队列功能
   - 分布式锁
 - Redis和项目结合：
   - Token存储
   - 登录失败次数计数
   - 地址缓存
   - 分布式锁
3. Redis有哪些数据结构
   - 基本数据结构（5种）
     - string（512MB）
       - 字符串、数字、二进制
       - 缓存、计数、共享session、限速
     - hash
       - key-value结构
       - 缓存用户信息、缓存对象
     - list
       - 存储多个有序的字符串，可以充当栈和队列的角色
       - 消息队列、文章列表
     - set
       - 存储多个字符串，无序，无重复
       - tag、共同关注
     - zset
       - 权重score作为排序依据
       - 点赞统计、用户排序
4. Redis为什么快呢？
   - 基于内存的数据存储。将数据存储在内存中，使得数据的读写操作避开了磁盘I/O。
   - 单线程模型。任何时刻只有一个命令在执行，避免了线程切换和锁竞争带来的消耗。
   - IO多路复用。基于linux的select/epoll机制，允许内核中同时存在多个监听套接字和已连接套接字，内核会一直监听这些套接字上的连接请求或数据请求，一旦有请求到达，就会交给Redis处理，实现了单线程处理所个IO读写请求。
    > - 什么是select/epoll机制？
    >   - unix-like系统中IO多路复用机制，管理多个文件描述符的就绪状态，从而使单个进程能同时监听多个文件描述符，等待其中任何一个或多个变为就绪状态，然后进行相应的读写操作，而不需要阻塞等待。
    > - 什么是文件描述符？
    >   - 文件描述符（File Descriptor）是一个用于访问文件或其它 I/O 设备的抽象概念，它是在 Unix 和类 Unix 操作系统中用于**标识已打开文件或 I/O 设备的整数**。文件描述符是操作系统提供给应用程序的接口，用于执行各种 I/O 操作，如读取、写入、关闭等。在 Unix 系统中，几乎所有的 I/O 操作都被视为文件操作，包括标准输入、标准输出、网络连接、管道、套接字等，它们都被表示为文件描述符。
    >   - 通常情况下，Unix 系统中的前三个文件描述符是：
    >     - 文件描述符 0：标准输入（stdin）
    >     - 文件描述符 1：标准输出（stdout）
    >     - 文件描述符 2：标准错误输出（stderr）
    >   - 文件描述符是由操作系统分配的，它们是唯一的并且在整个系统范围内有效。当应用程序打开一个文件或 I/O 设备时，操作系统会为其分配一个文件描述符，并在后续的 I/O 操作中使用该文件描述符来标识该文件或设备。在 C 语言中，文件描述符通常是一个整数，可以使用 open()、socket()、accept() 等系统调用来获取一个文件描述符，使用 read()、write()、close() 等系统调用来对其进行读写操作。
  - 高效的数据结构。Redis提供了多种高效的数据结构，进过了高度优化。
5. 能说一下I/O多路复用吗？
<!-- TODO -->
6. Redis为什么早期选择单线程？
7. Redis6.0使用多线程是怎么回事？
  Redis6.0的多线程是利用多线程处理数据读写和协议解析，但是执行命令还是单线程。
  Redis的性能瓶颈在于网络IO而并非CPU，多线程能提升IO的读写效率，从而整体提高Redis的性能。
  > 详细说一下Redis的性能瓶颈在网络IO而并非CPU？
  <!-- TODO -->

### 持久化
8. Redis的持久化方式有哪些？
- RDB：RDB持久化是把当前进程数据快照保存到硬盘的过程，触发RDB持久化过程分为手动触发和自动触发。
  RDB文件是一个压缩的二进制文件，可以还原某个时刻数据库的状态。由于RDB文件是保存在磁盘上的，即时Redis崩溃或退出，都可以用来恢复还原数据库的状态。
  手动触发分别对应save和bgsave命令。
	  - save命令：阻塞当前Redis服务器，直到RDB过程完成为止，对于内存比较大的实例会造成长时间阻塞，线上环境不建议使用。‘
	  - bgsave命令：Redis进程执行fork操作创建子进程，RDB持久化过程由子进程负责，完成后自动结束。
  以下场景会自动触发RDB持久化：
	  - 使用save相关配置，如`save m n`，表示m秒内数据集存在n次修改时，自动触发bgsave。
	  - 从节点执行全量复制操作，主节点自动执行bgsave生成RDB文件并发送给从节点。
	  - 执行debug reload命令重新加载Redis时。
	  - 默认情况下执行shutdown命令时，没有开始AOF持久化功能则会自动执行bgsave。
- AOF：AOF（append only file）持久化，以独立日志的方式每次记录写命令，重启时再重新执行AOF文件中的命令达到恢复数据的目的。主要作用是解决了数据持久化的实时性，目前已是Redis持久化的主流方式。
	- AOF的工作流程：命令写入（append）、文件同步（sync）、文件重写（rewrite）、重启加载（load）
	- 具体流程如下：
		- 1️⃣所有写入命令会追加到aof_buf缓冲区中
		- 2️⃣AOF缓冲区根据对应策略向硬盘做同步操作（有哪些对应策略呢？）
		- 3️⃣随着AOF文件越来越大，需要定期对AOF文件进行重写，达到压缩到目的
		- 4️⃣Redis服务器重启时，加载AOF文件进行数据恢复
9. RDB和AOF各有什么优缺点？
- RDB｜优点
	- 只有一个紧凑的二进制文件dump.rdb，非常适合备份，全量复制场景。
	- 容灾性好，可以把RDB文件拷贝到远程机器或者文件系统，用于容灾恢复。
	- 恢复速度快，RDB恢复数据的速度远快于AOF方式。
10. RDB和AOF如何选择？
11. Redis的数据恢复？
12. Redis4.0的混合持久化？
13. 主从复制？
14. Redis主从有几种常见的拓扑结构？
15. Redis的主从复制原理？
16. 主从复制同步方式？
17. 主从复制的问题？
18. Redis Sentinel哨兵机制？
19. 哨兵实现原理？
20. 领导者Sentinel节点选举？
21. 新的主节点如何挑选出来的？
22. Redis集群？
23. 集群中数据如何分区？
24. Redis集群的原理？
25. 集群的伸缩？
### 缓存设计
26. 缓存击穿、缓存穿透、缓存雪崩？
27. 布隆过滤器？
### 运维
   
# B树,B+树,红黑树
数据库系统普遍采用B-/+Tree作为索引结构（例如mysql的InnoDB引擎使用的B+树），理解不透彻B树，则无法理解数据库的索引机制.
B的意思为"平衡",B树的出现是为了弥补不同存储级别之间的访问速度上巨大差异,实现高效IO.平衡二叉树的查找效率非常高,可以通过降低树的深度提高查找效率.
当数据量非常大,树的存储元素树来嗯是有限的,二叉查找树结构由于树的深度过大造成磁盘IO读写过于频繁,进而导致查询效率低下.
数据量过大会导致内存空间不够容纳平衡二叉树所有节点的情况.
## B树
B树是一种自平衡树,维护有序数据并允许对数时间搜索/顺序访问/插入/删除.
B树是二叉搜索树的一般化,允许节点有两个以上的子节点.非常适合读取和写入相对较大数据块(如光盘)的存储系统,通常用于数据库和文件系统.

**定义**
- 每个节点最多只有m个子节点。
- 每个非叶子节点（除了根）具有至少⌈m/2⌉子节点。
- 如果根不是叶节点，则根至少有两个子节点。
- 具有k个子节点的非叶节点包含k -1个键。
- 所有叶子都出现在同一水平，没有任何信息（高度一致）。
## B+树

## B*树

## 红黑树